## Что было сделано?

* Выполнены минимальные требования
* Добавлен TLL для внесения пользователей в группу до определённого момента времени
* Проведено ручное тестирование с помощью curl

## Предположения сервиса
* Регистрацией пользователем и хранением их информации, например, идентификатора занимается другой сервис

## Инструкция по запуску

Весь проект можно запустить с использованием Docker. Для этого нужно запустить следующую команду:
```bash
docker compose up
```

По умолчанию выставлены следующие параметры запуска:
* PostgreSQL запускается на 5436 порту локально, а в контейнере Docker запускатеся на 5432 порту. Для изменения порта по умолчанию необходимо внести изменения в [docker-compose.yaml](docker-compose.yaml) и в [config-файл](config/local.yaml).
* Сервис по управлению сегментами пользователей запускается на 8082 порту локально, а в контейнере Docker запускается на 8080 порту. Для изменения порта по умолчанию необходимо внести изменения в [docker-compose.yaml](docker-compose.yaml) и в [config-файл](config/local.yaml).

## Примечание

* Почему-то порой docker контейнер с базой данных запускается позже, чем сам сервис. Из-за этого контейнер с сервисом падает. В таком случае нужно остановить сервисы и запустить контейнееры по новому.

## API сервиса

Сервис предоставляет 4 метода:

* POST /segments — для добавления нового сегмента с именем slug, передаваемом в теле запроса
* Delete /segments/{slug} — для удаления сегмента с именем slug
* Get /user/{user_id} — для получения сегментов пользователя с идентефикатором, равном user_id
* Post /user — для добавлеения и удаления сегментов пользователя, также для добавленых сегментов можно добавить время, до которого пользователь должен находится в сегменте. Вся необходимая информация передаётся в теле запроса. 
    + Этот метод гарантирует, что в случае неверных данных в запросе (например, несуществующих сегментов) НИКАКИЕ изменения не будут внесены в базу данных.
    + Этот метод гарантирует, удаление сегментов происходит перед их добавлением.
    + Время, до которого пользователь должен находиться в сегменту нужно передавать в формате RFC3339.
    + Также частоту проверки базы данных на удаление пользователей из сегментов можно регулировать в [config-файлe](config/local.yaml) 

Наглядное применение методов можно увидеть в секции  [Примеры](#примеры)

## Примеры

Все примеры используют использовать утилиту curl.

* Добавление нового сегмента AVITO_DISCOUNT_30.
```bash
curl -X POST http://localhost:8082/segments -H "Content-Type: application/json" -d '{ "slug":"AVITO_DISCOUNT_30" }' 
```

* Удаление сегмента AVITO_DISCOUNT_30.
```bash
curl -X DELETE http://localhost:8082/segments/AVITO_DISCOUNT_30 
```

* Добавление пользователя с id=1 в сегмент AVITO_DISCOUNT_30.
```bash
curl -X POST http://localhost:8082/user -H "Content-Type: application/json" -d '{ "user_id":1, "segments_to_add":[ {"slug": "AVITO_DISCOUNT_30"}] }'
```

* Удаление пользователя с id=1 из сегмента AVITO_DISCOUNT_30.
```bash
curl -X POST http://localhost:8082/user -H "Content-Type: application/json" -d '{ "user_id":1, "segments_to_delete": ["AVITO_DISCOUNT_30"]}' 
```

* Одновременно удаление пользователя с id=1 из сегмента AVITO_DISCOUNT_30 и его последующее добавление в сегмент AVITO_DISCOUNT_50. 

```bash
curl -X POST http://localhost:8082/user -H "Content-Type: application/json" -d '{ "user_id":1, "segments_to_delete": ["AVITO_DISCOUNT_30"], "segments_to_add":[ {"slug": "AVITO_DISCOUNT_50"}] }'
```

* Добавление пользователя с id=1 в сегмент AVITO_DISCOUNT_30 до 2023-08-31T13:10:00Z (формат RFC3339).

```bash
curl -X POST http://localhost:8082/user -H "Content-Type: application/json" -d '{ "user_id":1, "segments_to_add":[ {"slug": "AVITO_DISCOUNT_30", "expiration_date": "2023-08-31T13:10:00Z"}] }'

```

## Дополнитель
* Инициализация базы данных происходит в [файле](internal/storage/postgresql/postgresql.go) в методе New()